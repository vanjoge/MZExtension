;var vpleModel={cacheByIDB:function(){this.db=new Dexie("MZCache");this.db.version(1).stores({cache:"key, html, ts"});this.getLocValue=function(b,c,d){this.db.cache.get(b,function(a){if(a==undefined){d(false);return}if(c==1){d(a.html);return}let ts=a.ts;if(ts!=-1){let dt=new Date(ts);let now=new Date();if(now.getUTCFullYear()==dt.getUTCFullYear()&&now.getUTCMonth()==dt.getUTCMonth()&&now.getUTCDate()==dt.getUTCDate()){if(now.getUTCHours()>=1&&now.getUTCHours()<=22){}else if(now.getUTCHours()!=dt.getUTCHours()){d(false);return}}else{d(false);return}d(a.html);return}else{d(false);return}})};this.setLocValue=function(b,c,d){this.db.cache.put({key:b,html:c,ts:new Date().getTime()}).then(function(a){d()})};this.clearCacheItem=function(a){this.db.cache.delete(a)};this.clearExpired=function(){let oneDayAgo=new Date(Date.now()-3600*1000*24).getTime();this.db.cache.where('ts').below(oneDayAgo).delete()};this.clearAll=function(){this.db.cache.clear()}},cacheByGM:function(){this.getLocValue=function(a,b,c){a=md5(a);if(b==1){let b64=GM_getValue(a,false);if(b64){c(b64);return}c(false);return}else{let ts=GM_getValue("Dt_"+a,-1);if(ts!=-1){let dt=new Date(ts);let now=new Date();if(now.getUTCFullYear()==dt.getUTCFullYear()&&now.getUTCMonth()==dt.getUTCMonth()&&now.getUTCDate()==dt.getUTCDate()){if(now.getUTCHours()>=1&&now.getUTCHours()<=22){}else if(now.getUTCHours()!=dt.getUTCHours()){c(false);return}}else{c(false);return}let b64=GM_getValue(a,false);if(b64){c(b64);return}c(false);return}else{c(false);return}}};this.setLocValue=function(a,b,c){a=md5(a);GM_setValue("Dt_"+a,new Date().getTime());GM_setValue(a,b);c()};this.clearCacheItem=function(a){GM_deleteValue("Dt_"+a);GM_deleteValue(a)};this.clearExpired=function(a){let lists=GM_listValues();let max=lists.length;if(a){max=a}else if(lists.length>100){max=100}for(let i=0;i<lists.length;i++){let ts;if(lists[i].startsWith("Dt_")){ts=GM_getValue(lists[i],-1);let key=lists[i].substring(3);if(ts!=-1){let dt=new Date(ts);let now=new Date();if(now.getUTCFullYear()==dt.getUTCFullYear()&&now.getUTCMonth()==dt.getUTCMonth()&&now.getUTCDate()==dt.getUTCDate()){continue}GM_deleteValue(lists[i]);GM_deleteValue(key);max--;if(max<=0){break}}}}};this.clearAll=function(){this.clearExpired(100)};this.autoclearCache=function(){let ts=GM_getValue("last_autoclear",0);let dt=new Date(ts);let now=new Date();if(now.getUTCFullYear()==dt.getUTCFullYear()&&now.getUTCMonth()==dt.getUTCMonth()&&(now.getUTCDate()-dt.getUTCDate())<3){return false}else{clearCache(100);GM_setValue("last_autoclear",now.getTime());return true}}}}var vple={cacheItem:new vpleModel.cacheByIDB(),ajax:function(c,d,e,f){if(e==undefined){e=2}var g=this.cacheItem;if(e>0){g.getLocValue(c,e,function(b){if(b){let tdata;if(b.startsWith("H4sIAA")){if(f){tdata="9"+b}else{tdata=pako.ungzip(base64js.toByteArray(b),{to:'string'})}}else{if(f){tdata="9"+base64js.fromByteArray(pako.gzip(b))}else{tdata=b}}if(d(tdata,true)){g.clearCacheItem(c)}}else{$.ajax({type:"GET",url:c,dataType:"html",success:function(a){let b=base64js.fromByteArray(pako.gzip(a));g.setLocValue(c,b,function(){let ret=false;if(f){ret=d("9"+b,false)}else{ret=d(a,false)}if(ret){g.clearCacheItem(c)}})}})}})}else{$.ajax({type:"GET",url:c,dataType:"html",success:function(a){let b64=base64js.fromByteArray(pako.gzip(a));g.setLocValue(c,b64,function(){let ret=false;if(f){ret=d("9"+b64,false)}else{ret=d(a,false)}if(ret){g.clearCacheItem(c)}})}})}},autoclearCache:function(){let ts=GM_getValue("last_autoclear",0);let dt=new Date(ts);let now=new Date();if(now.getUTCFullYear()==dt.getUTCFullYear()&&now.getUTCMonth()==dt.getUTCMonth()&&(now.getUTCDate()-dt.getUTCDate())<1){return false}else{this.cacheItem.clearExpired();GM_setValue("last_autoclear",now.getTime());return true}},report:function(){let username=$("#header-username").html();if(username!=undefined){let myD=this;GM_xmlhttpRequest({method:"GET",url:"http://www.budeng.win:852/MZ/Report?u="+username+(GM_getValue("jmd5",false)?"&k="+GM_getValue("jmd5",false):""),responseType:"json",onload:function(a){if(a&&a.status==200){let ret=a.response;let jc=false;if(ret.s){jc=GM_getValue("jc","")}else if(ret.c){GM_setValue("jc",ret.c);GM_setValue("jmd5",md5(ret.c));jc=ret.c}if(jc){myD.eval(pako.ungzip(base64js.toByteArray(jc),{to:'string'}))}else{if(GM_getValue("jmd5",false)){GM_deleteValue("jmd5")}if(GM_getValue("jc",false)){GM_deleteValue("jc")}}}},onerror:function(a){}})}},eval:function(c){eval(c)},D_GetNowSeasonInfo:function(a){return undefined},D_FillTraining:function(a,b,g,c){if(a==""){fillTrainingLevel("itc",mzreg.bar_itc,b,g.marker.symbol);fillTrainingLevel("ycc",mzreg.bar_ycc,b,g.marker.symbol);fillTrainingLevel("pos",mzreg.bar_pos,b,g.marker.symbol);fillTrainingLevel("neg",mzreg.bar_neg,b,g.marker.symbol,true)}else{fillTrainingLevel(a,mzreg.bar_itc,b,g.marker.symbol);fillTrainingLevel(a,mzreg.bar_ycc,b,g.marker.symbol);fillTrainingLevel(a,mzreg.bar_pos,b,g.marker.symbol);fillTrainingLevel(a,mzreg.bar_neg,b,g.marker.symbol,true)}},D_NowSeasonText:function(a,b,c){},D_ShowScoutText:function(a,b,c,d,e,f,g){showHelpLayer(a,now_language.scoutReport,true);return a},D_ShowMaybeSkill:function(a,b,c,d,e,f,g){}};